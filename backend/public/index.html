<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Socket.io Chat</title>

<style>
body {
  background:#1d1e26;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:'Poppins',sans-serif;
}

.chat-box {
  width:90%;
  max-width:600px;
  height:80vh;
  background:#22232f;
  border-radius:20px;
  padding:15px;
  display:flex;
  flex-direction:column;
  box-shadow:0 0 20px rgba(0,0,0,0.4);
}

.header {
  background:linear-gradient(135deg,#4e54c8,#8f94fb);
  color:white;
  padding:15px;
  text-align:center;
  border-radius:12px;
}

#messages {
  flex:1;
  background:#11121a;
  margin-top:10px;
  padding:10px;
  border-radius:10px;
  overflow-y:auto;
  color:#eee;
}

.msg { 
  padding:8px 12px;
  border-radius:10px;
  max-width:70%;
  margin-bottom:12px;
}

.sent { background:#4e54c8; color:#fff; margin-left:auto; }
.recv { background:#2c2f3f; color:#eee; }

.sender { font-size:12px; font-weight:bold; }
.time { font-size:10px; opacity:0.6; margin-top:2px; }

.input-row {
  display:flex;
  gap:10px;
  margin-top:10px;
}
input, button {
  padding:10px;
  border:none;
  border-radius:8px;
  outline:none;
}
#name { width:110px; background:#fff; }
#text { flex:1; background:#22232f; color:#fff; border:1px solid #4e54c8; }
button {
  background:linear-gradient(135deg,#4e54c8,#8f94fb);
  color:white;
  font-weight:bold;
  cursor:pointer;
}
#typing { font-size:12px;color:#aaa;padding-left:5px; }
</style>
</head>
<body>

<div class="chat-box">
  <div class="header">
    <span id="status">ðŸ”´</span> &nbsp; Realtime Chat ðŸ’¬
  </div>

  <div id="messages">
    <p style="text-align:center;color:#aaa;margin-top:5px;">ðŸ‘‹ Welcome to the chat</p>
  </div>

  <p id="typing"></p>

  <div class="input-row">
    <input type="text" id="name" value="User">
    <input type="text" id="text" placeholder="Type message...">
    <button id="send">Send</button>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    const status = document.getElementById("status");
    const messages = document.getElementById("messages");
    const typing = document.getElementById("typing");
    const nameInput = document.getElementById("name");
    const textInput = document.getElementById("text");
    const sendBtn = document.getElementById("send");
    
    // ðŸŸ¢ Connected / ðŸ”´ Disconnected
    socket.on("connect", ()=> status.textContent="ðŸŸ¢");
    socket.on("disconnect", ()=> status.textContent="ðŸ”´");
    
    // send message
    sendBtn.onclick = ()=>{
      if(!textInput.value.trim() || !nameInput.value.trim()) return;
      socket.emit("chatMessage",{text:textInput.value,user:nameInput.value});
      textInput.value="";
      socket.emit("typing",{typing:false});
      typing.textContent="";
    };
    
    // receive messages
    socket.on("message", data=>{
      showMessage(data, data.user===nameInput.value ? "sent":"recv");
    });
    
    function showMessage(m, type){
      const div = document.createElement("div");
      div.className = `msg ${type}`;
      div.innerHTML = `
        <div class="sender">${m.user}</div>
        <div>${m.text}</div>
        <div class="time">${new Date(m.timestamp).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }
    
    // typing indicator
    textInput.oninput = ()=> socket.emit("typing",{user:nameInput.value,typing:textInput.value.trim()!==""});
    socket.on("typing",d=> typing.textContent = d.typing ? `${d.user} typing...` : "");
    
    // send + receive messages (second button function)
    function sendMessage(){
      const message = textInput.value.trim();
      const user = nameInput.value.trim();
      if(message && user){
          socket.emit("sendMessage",{text:message,user:user});
          textInput.value="";
          socket.emit("typing",{typing:false});
          typing.textContent="";
      }
    }
    sendBtn.addEventListener("click", sendMessage);
    
    // Enter key
    textInput.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
          event.preventDefault();
          sendMessage();
      }
    });
    
    // FIXED receive event (was wrong before)
    socket.on('receiveMessage',(data)=>{
      const currentUser = nameInput.value.trim() || "User";
      const messageType = data.user===currentUser ? "sent" : "recv";
      showMessage(data, messageType);
    });
    </script>

</body>
</html>
